<ng-template #name pTemplate="body" let-node>
  <display-badge [type]="node.node.data.displayData.type"></display-badge>{{node.node.data.position}}. {{node.node.data.name}}
</ng-template>
<ng-template #cardinality pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.type === 'FIELD'">
    <input id="{{node.node.data.displayData.idPath}}-min" name="{{node.node.data.displayData.idPath}}-min" required [(ngModel)]="node.node.data.min" type="number" style="width:45%;border-width:0px 0px 1px 0px"/>
    <input id="{{node.node.data.displayData.idPath}}-max" name="{{node.node.data.displayData.idPath}}-max" required [(ngModel)]="node.node.data.max" type="text" style="width:45%;border-width:0px 0px 1px 0px"/>
  </div>
</ng-template>
<ng-template #usage pTemplate="body" let-node>

  <div *ngIf="node.node.data.displayData.type === 'FIELD'">
    <p-dropdown *ngIf="node.node.data.usage !== 'C'" [options]="usages" id="{{node.node.data.displayData.idPath}}-usage" name="{{node.node.data.displayData.idPath}}-usage" required [(ngModel)]="node.node.data.usage" appendTo="body" (onChange)="onUsageChange(node.node)" [style]="{'width' : '100%'}"></p-dropdown>
    <div *ngIf="node.node.data.usage === 'C'">
      <p-dropdown [options]="usages" id="{{node.node.data.displayData.idPath}}-usage" name="{{node.node.data.displayData.idPath}}-usage" [(ngModel)]="node.node.data.usage" appendTo="body" (onChange)="onUsageChange(node.node)" [style]="{'width' : '30%'}"></p-dropdown>
      (<p-dropdown [options]="cUsages" id="{{node.node.data.displayData.idPath}}-tUsage" name="{{node.node.data.displayData.idPath}}-tUsage" [(ngModel)]="node.node.data.displayData.segmentBinding.predicate.trueUsage" appendTo="body" [style]="{'width' : '30%'}"></p-dropdown>/
      <p-dropdown [options]="cUsages" id="{{node.node.data.displayData.idPath}}-fUsage" name="{{node.node.data.displayData.idPath}}-fUsage" [(ngModel)]="node.node.data.displayData.segmentBinding.predicate.falseUsage" appendTo="body" [style]="{'width' : '30%'}"></p-dropdown>)
    </div>
  </div>
  <div *ngIf="node.node.data.displayData.type === 'COMPONENT'">
    <div *ngIf="node.node.data.usage !== 'C' || !node.node.data.displayData.fieldDTbinding|| !node.node.data.displayData.fieldDTbinding.predicate">{{node.node.data.usage}}</div>
    <div *ngIf="node.node.data.usage === 'C' && node.node.data.displayData.fieldDTbinding && node.node.data.displayData.fieldDTbinding.predicate">C({{node.node.data.displayData.fieldDTbinding.predicate.trueUsage}}/{{node.node.data.displayData.fieldDTbinding.predicate.falseUsage}})</div>
  </div>
  <div *ngIf="node.node.data.displayData.type === 'SUBCOMPONENT'">
    <div *ngIf="node.node.data.usage !== 'C' || !node.node.data.displayData.componentDTbinding || !node.node.data.displayData.componentDTbinding.predicate">{{node.node.data.usage}}</div>
    <div *ngIf="node.node.data.usage === 'C' && node.node.data.displayData.componentDTbinding && node.node.data.displayData.componentDTbinding.predicate">C({{node.node.data.displayData.componentDTbinding.predicate.trueUsage}}/{{node.node.data.displayData.componentDTbinding.predicate.falseUsage}})</div>
  </div>
</ng-template>
<ng-template #length pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.type === 'FIELD'">
    <div *ngIf="node.node.data.minLength !== 'NA' && node.node.data.displayData.datatype.leaf">
      <input id="{{node.node.data.displayData.idPath}}-minLength" name="{{node.node.data.displayData.idPath}}-minLength"  [(ngModel)]="node.node.data.minLength" type="number" style="width:40%;border-width:0px 0px 1px 0px"/>
      <input id="{{node.node.data.displayData.idPath}}-maxLength" name="{{node.node.data.displayData.idPath}}-maxLength"  [(ngModel)]="node.node.data.maxLength" type="text" style="width:40%;border-width:0px 0px 1px 0px"/>
      <i class="fa fa-times" (click)="delLength(node.node)" style="width:20%;"></i>
    </div>
  </div>
  <div *ngIf="node.node.data.displayData.type !== 'FIELD'">
    [{{node.node.data.minLength}}..{{node.node.data.maxLength}}]
  </div>

</ng-template>
<ng-template #confLength pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.type === 'FIELD'">
    <ng-container *ngIf="node.node.data.confLength !== 'NA' && node.node.data.displayData.datatype.leaf">
      <input [(ngModel)]="node.node.data.confLength" id="{{node.node.data.displayData.idPath}}-confLength" name="{{node.node.data.displayData.idPath}}-confLength"  type="text" style="width: 80%;border-width:0px 0px 1px 0px"/>
      <i class="fa fa-times" (click)="delConfLength(node.node)" style="width:20%;"></i>
    </ng-container>
  </div>
  <div *ngIf="node.node.data.displayData.type !== 'FIELD'">
    {{node.node.data.confLength}}
  </div>
</ng-template>
<ng-template #datatype pTemplate="body" let-node>
  <div *ngIf="!node.node.data.displayData.datatype.edit">
    <display-ref [elm]="node.node.data.displayData.datatype"></display-ref>
    <i class="fa fa-pencil" *ngIf="node.node.data.displayData.type === 'FIELD'" (click)="makeEditModeForDatatype(node.node)"></i>
  </div>
  <div *ngIf="node.node.data.displayData.datatype.edit">
    <p-dropdown id="{{node.node.data.displayData.idPath}}-datatype" name="{{node.node.data.displayData.idPath}}-datatype" [options]="node.node.data.displayData.datatype.dtOptions" [(ngModel)]="node.node.data.displayData.datatype.id" (onChange)="onDatatypeChange(node.node)" appendTo="body" [style]="{'width':'100%'}">
      <ng-template let-option pTemplate="body">
        <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
          <display-ref *ngIf="option.value" [elm]="getDatatypeElm(option.value)"></display-ref>
          <span *ngIf="!option.value" (click)="editDatatypeForField(node.node)">{{option.label}}</span>
        </div>
      </ng-template>
    </p-dropdown>
  </div>
</ng-template>
<ng-template #valueSet pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.valuesetAllowed && !node.node.data.displayData.hasSingleCode">
    <div *ngIf="node.node.data.displayData.segmentBinding">
      <div *ngFor="let vs of node.node.data.displayData.segmentBinding.valuesetBindings">
        <display-ref [elm]="vs" [from]="'SEGMENT'"></display-ref>
        <i class="fa fa-pencil" (click)="makeEditModeForValueSet(node.node,vs)" style="width:20%;"></i>
        <i class="fa fa-times" (click)="delValueSetBinding(node.node.data.displayData.segmentBinding, vs, node.node.data.displayData)" style="width:20%;"></i>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.valuesetBindings || node.node.data.displayData.segmentBinding.valuesetBindings.length === 0) && node.node.data.displayData.fieldDTbinding">
      <div *ngFor="let vs of node.node.data.displayData.fieldDTbinding.valuesetBindings">
        <display-ref [elm]="vs" [from]="'FIELD'"></display-ref>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.valuesetBindings || node.node.data.displayData.segmentBinding.valuesetBindings.length === 0) && (!node.node.data.displayData.fieldDTbinding || !node.node.data.displayData.fieldDTbinding.valuesetBindings || node.node.data.displayData.fieldDTbinding.valuesetBindings.length === 0) && node.node.data.displayData.componentDTbinding">
      <div *ngFor="let vs of node.node.data.displayData.componentDTbinding.valuesetBindings">
        <display-ref [elm]="vs" [from]="'COMPONENT'"></display-ref>
      </div>
    </div>
    <i class="fa fa-plus" *ngIf="node.node.data.displayData.multipleValuesetAllowed || !node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.valuesetBindings || node.node.data.displayData.segmentBinding.valuesetBindings.length == 0" (click)="editValueSetBinding(node.node)"></i>
  </div>
</ng-template>
<ng-template #constantValue pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.datatype.leaf && !node.node.data.displayData.valuesetAllowed">
    <div *ngIf="node.node.data.displayData.segmentBinding">
      <div *ngIf="node.node.data.displayData.segmentBinding.constantValue">
        <display-constantvalue [elm]="node.node.data.displayData.segmentBinding.constantValue" [from]="'SEGMENT'"></display-constantvalue>
        <i class="fa fa-pencil" (click)="makeEditModeForConstantValue(node.node)" style="width:20%;"></i>
        <i class="fa fa-times" (click)="deleteConstantValue(node.node)" style="width:20%;"></i>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.constantValue) && node.node.data.displayData.fieldDTbinding">
      <div *ngIf="node.node.data.displayData.fieldDTbinding.constantValue !== undefined  && node.node.data.displayData.fieldDTbinding.constantValue !== ''">
        <display-constantvalue [elm]="node.node.data.displayData.fieldDTbinding.constantValue" [from]="'FIELD'"></display-constantvalue>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.constantValue) && (!node.node.data.displayData.fieldDTbinding || !node.node.data.displayData.fieldDTbinding.constantValue) && node.node.data.displayData.componentDTbinding">
      <div *ngIf="node.node.data.displayData.componentDTbinding.constantValue  !== undefined && node.node.data.displayData.componentDTbinding.constantValue !== ''">
        <display-constantvalue [elm]="node.node.data.displayData.componentDTbinding.constantValue" [from]="'COMPONENT'"></display-constantvalue>
      </div>
    </div>
    <div *ngIf="!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.editConstantValue">
      <i class="fa fa-plus" *ngIf="!node.node.data.displayData.segmentBinding || (node.node.data.displayData.segmentBinding && !node.node.data.displayData.segmentBinding.constantValue)" (click)="addNewConstantValue(node.node)"></i>
    </div>
  </div>

</ng-template>
<ng-template #singlecode pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.valuesetAllowed && node.node.data.displayData.datatype.leaf && !node.node.data.displayData.hasValueSet">
    <div *ngIf="node.node.data.displayData.segmentBinding">
      <div *ngIf="node.node.data.displayData.segmentBinding.externalSingleCode">
        <display-singlecode [elm]="node.node.data.displayData.segmentBinding.externalSingleCode" [from]="'SEGMENT'"></display-singlecode>
        <i class="fa fa-pencil" (click)="makeEditModeForSingleCode(node.node)" style="width:20%;"></i>
        <i class="fa fa-times" (click)="deleteSingleCode(node.node)" style="width:20%;"></i>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.externalSingleCode) && node.node.data.displayData.fieldDTbinding">
      <div *ngIf="node.node.data.displayData.fieldDTbinding.externalSingleCode">
        <display-singlecode [elm]="node.node.data.displayData.fieldDTbinding.externalSingleCode" [from]="'FIELD'"></display-singlecode>
      </div>
    </div>
    <div *ngIf="(!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.externalSingleCode) && (!node.node.data.displayData.fieldDTbinding || !node.node.data.displayData.fieldDTbinding.externalSingleCode) && node.node.data.displayData.componentDTbinding">
      <div *ngIf="node.node.data.displayData.componentDTbinding.externalSingleCode">
        <display-singlecode [elm]="node.node.data.displayData.componentDTbinding.externalSingleCode" [from]="'COMPONENT'"></display-singlecode>
      </div>
    </div>
    <i class="fa fa-plus" *ngIf="!node.node.data.displayData.segmentBinding || !node.node.data.displayData.segmentBinding.externalSingleCode" (click)="addNewSingleCode(node.node)"></i>
  </div>
</ng-template>
<ng-template #predicate pTemplate="body" let-node>
  <div *ngIf="node.node.data.usage === 'C'">
    <div *ngIf="node.node.data.displayData.type === 'FIELD'">
      <div *ngIf="node.node.data.displayData.segmentBinding && node.node.data.displayData.segmentBinding.predicate && node.node.data.displayData.segmentBinding.predicate.freeText">
        {{node.node.data.displayData.segmentBinding.predicate.freeText}}
      </div>
      <div *ngIf="node.node.data.displayData.segmentBinding && node.node.data.displayData.segmentBinding.predicate && node.node.data.displayData.segmentBinding.predicate.assertion && node.node.data.displayData.segmentBinding.predicate.assertion.description">
        {{node.node.data.displayData.segmentBinding.predicate.assertion.description}}
      </div>
      <i class="fa fa-pencil" (click)="editPredicate(node.node)" style="width:20%;"></i>
    </div>
    <div *ngIf="node.node.data.displayData.type === 'COMPONENT'">
      <div *ngIf="node.node.data.displayData.fieldDTbinding && node.node.data.displayData.fieldDTbinding.predicate && node.node.data.displayData.fieldDTbinding.predicate.freeText">
        {{node.node.data.displayData.fieldDTbinding.predicate.freeText}}
      </div>
      <div *ngIf="node.node.data.displayData.fieldDTbinding && node.node.data.displayData.fieldDTbinding.predicate && node.node.data.displayData.fieldDTbinding.predicate.assertion && node.node.data.displayData.fieldDTbinding.predicate.assertion.description">
        {{node.node.data.displayData.fieldDTbinding.predicate.assertion.description}}
      </div>
    </div>
    <div *ngIf="node.node.data.displayData.type === 'SUBCOMPONENT'">
      <div *ngIf="node.node.data.displayData.componentDTbinding && node.node.data.displayData.componentDTbinding.predicate && node.node.data.displayData.componentDTbinding.predicate.freeText">
        {{node.node.data.displayData.componentDTbinding.predicate.freeText}}
      </div>
      <div *ngIf="node.node.data.displayData.componentDTbinding && node.node.data.displayData.componentDTbinding.predicate && node.node.data.displayData.componentDTbinding.predicate.assertion && node.node.data.displayData.componentDTbinding.predicate.assertion.description">
        {{node.node.data.displayData.componentDTbinding.predicate.assertion.description}}
      </div>
    </div>
  </div>
</ng-template>
<ng-template #text pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.type === 'FIELD'">
    <ng-container *ngIf="node.node.data.text">
      <span (click)="editTextDefinition(node.node)">{{truncate(node.node.data.text)}}</span>
      <i class="fa fa-times" (click)="delTextDefinition(node.node)" style="width:20%;"></i>
    </ng-container>
    <ng-container *ngIf="!node.node.data.text">
      <i class="fa fa-pencil" (click)="editTextDefinition(node.node)"></i>
    </ng-container>
  </div>
</ng-template>
<ng-template #comment pTemplate="body" let-node>
  <div *ngIf="node.node.data.displayData.segmentBinding">
    <div *ngFor="let c of node.node.data.displayData.segmentBinding.comments">

                        <span>
                            <display-comment [elm]="c" [from]="'SEGMENT'"></display-comment>
                            <i class="fa fa-pencil" (click)="makeEditModeForComment(node.node, c)" style="width:20%;"></i>
                            <i class="fa fa-times" (click)="delCommentBinding(node.node.data.displayData.segmentBinding, c)" style="width:20%;"></i>
                        </span>

    </div>
  </div>
  <div *ngIf="node.node.data.displayData.fieldDTbinding">
    <div *ngFor="let c of node.node.data.displayData.fieldDTbinding.comments">
      <display-comment [elm]="c" [from]="'FIELD'"></display-comment>
    </div>
  </div>
  <div *ngIf="node.node.data.displayData.componentDTbinding">
    <div *ngFor="let c of node.node.data.displayData.componentDTbinding.comments">
      <display-comment [elm]="c" [from]="'COMPONENT'"></display-comment>
    </div>
  </div>
  <i class="fa fa-plus" (click)="addNewComment(node.node)"></i>
</ng-template>
