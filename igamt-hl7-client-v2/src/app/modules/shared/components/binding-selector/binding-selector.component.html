<h2 mat-dialog-title>Edit Binding</h2>
<mat-dialog-content style="min-height: 300px">
  <div>
    <p-radioButton [(ngModel)]="selectedBindingType" label="Value set" name="vs" value="VALUESET"></p-radioButton>

    <p-radioButton [(ngModel)]="selectedBindingType" [style]="{'margin-left': '50px'}" label="Single code" name="sg"
                   value="SINGLECODE"></p-radioButton>
  </div>

  <p-dropdown (ngModelChange)="loadCodes($event)" *ngIf="selectedBindingType!=='VALUESET'" [(ngModel)]="selectedValueSet"
              [optionLabel]="'variableName'" [options]="data.resources" placeholder="select value set" [style]="{'minWidth':'100%'}">
    <ng-template let-item pTemplate="selectedItem">
      <ng-container *ngIf="item.value">
        <app-display-section [element]="item.value"></app-display-section>
      </ng-container>
    </ng-template>
    <ng-template let-item pTemplate="item">
      <app-display-section [element]="item.value"></app-display-section>
    </ng-template>
  </p-dropdown>

  <div class="select-binding-container">
    <div class="loaded">
      <div *ngIf="selectedBindingType=='VALUESET'">
        <p-table #dt1 [globalFilterFields]="['variableName','name']" [style]="{'width': '400px'}" [value]="data.resources"
                 scrollHeight="100%" scrollable="true"
                 sortField="bindingIdentifier">
          <ng-template pTemplate="caption">
            <div style="text-align: left">
              <div class="input-group" style="margin-left: 10px;">
                <div class="input-group-prepend" style="height: 35px;">
                  <span class="input-group-text" id="inputGroupPrepend3"><i class="fa fa-filter"></i></span>
                </div>
                <input (input)="dt1.filterGlobal($event.target.value, 'contains')" class="form-control"
                       placeholder="Filter"
                       style="background-color: #f0f0f0; text-align: left; height: 35px;" type="text">
              </div>
            </div>
          </ng-template>
          <ng-template let-columns pTemplate="header">
            <tr>
              <th class="header-padding">
                Value Sets
              </th>
              <th class="header-padding" style="width:65px">
                Add
              </th>

            </tr>
          </ng-template>
          <ng-template let-columns="columns" let-expanded="expanded" let-index="rowIndex" let-node="node" let-rowData
                       let-rowNode pTemplate="body">
            <tr>
              <td>
                <app-display-section [element]="rowData"></app-display-section>
              </td>
              <td style="width:65px">
                <button (click)="selectValueSet(rowData)" class="btn-primary btn btn-sm">
                  <i class="fa fa-plus"></i>
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div *ngIf="selectedBindingType=='SINGLECODE'">
        <div *ngIf="currentValueSet && currentValueSet.codes">
          <p-table #tb2 [globalFilterFields]="['variableName','name']" [style]="{'width': '400px'}"
                   [value]="currentValueSet.codes" scrollHeight="100%" scrollable="true"
                   sortField="bindingIdentifier">
            <ng-template pTemplate="caption">
              <div style="text-align: left">
                <div class="input-group" style="margin-left: 10px;">
                  <div class="input-group-prepend" style="height: 35px;">
                    <span class="input-group-text" id="inputGroupPrepend2"><i class="fa fa-filter"></i></span>
                  </div>
                  <input (input)="tb2.filterGlobal($event.target.value, 'contains')" class="form-control"
                         placeholder="Filter"
                         style="background-color: #f0f0f0; text-align: left; height: 35px;" type="text">
                </div>
              </div>
            </ng-template>
            <ng-template let-columns pTemplate="header">
              <tr>
                <th class="header-padding">
                  Value
                </th>
                <th>
                  Description
                </th>
                <th class="header-padding">
                  Code System
                </th>
                <th class="header-padding" style="width:65px">
                  Add
                </th>
              </tr>
            </ng-template>
            <ng-template let-columns="columns" let-expanded="expanded" let-index="rowIndex" let-node="node" let-rowData
                         let-rowNode pTemplate="body">
              <tr>
                <td>
                  {{rowData.value}}
                </td>
                <td>
                  {{rowData.description}}
                </td>
                <td>
                  {{rowData.codeSystem}}
                </td>
                <td style="width:65px">
                  <button (click)="selectCode(rowData)" class="btn-primary btn btn-sm">
                    <i class="fa fa-plus"></i>
                  </button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
    <div class="selected">
      <div *ngIf="selectedBindingType=='SINGLECODE'">
        <div *ngIf="selectedSingleCode">
          <label> Code: </label>
              {{selectedSingleCode.code}}
          <br/>
          <label> Code System:</label>
            {{selectedSingleCode.codeSystem}}
          <br/>
          <app-display-section [element]="selectedSingleCode.valueSet"></app-display-section>
          <button type="button" label="Cancel" class="btn btn-sm btn-danger" style="float: right" (click)="clearCode()"><i class="fa fa-remove"></i>remove</button>
        </div>
      </div>
      <div *ngIf="selectedBindingType=='VALUESET'">
        <p-table #dt1 [style]="{'width': '400px'}" [value]="selectedValueSets"
                 sortField="bindingIdentifier">
          <ng-template let-columns pTemplate="header">
            <tr>
              <th class="header-padding">
                Value Sets
              </th>

              <th class="header-padding">
                Binding Strength
              </th>

              <th *ngIf="data.locationInfo.allowedBindingLocations && data.locationInfo.allowedBindingLocations.length > 1">
                Binding Location
              </th>

              <th class="header-padding" style="width:65px">
              </th>

            </tr>
          </ng-template>
          <ng-template let-columns="columns" let-expanded="expanded" let-index="rowIndex" let-node="node" let-rowData
                       let-rowNode pTemplate="body">
            <tr>
              <td>
                <app-display-section [element]="rowData.display" hideDescription="true"></app-display-section>
              </td>
              <td #anchor1>
                <p-dropdown [(ngModel)]="rowData.bindingStrength" [appendTo]="anchor1" [style]="{'min-width': 'unset','width': '100%'}"
                            [id]="'bindingStrength'+rowData.display.id" [name]="'bindingStrength'+rowData.display.id" [options]="bindingStrengthOptions"></p-dropdown>
              </td>
              <td #anchor2 *ngIf="data.locationInfo.allowedBindingLocations && data.locationInfo.allowedBindingLocations.length > 1">
                <p-dropdown [(ngModel)]="rowData.bindingLocationOptions" [appendTo]="anchor2" [style]="{'min-width': 'unset','width': '100%'}"
                             [id]="'bindingLocation'+rowData.display.id" [name]="'bindingLocation'+rowData.display.id" [options]=" data.locationInfo.allowedBindingLocations"></p-dropdown>
              </td>
              <td style="width:65px">
                <button (click)="remove(rowData)" class="btn btn-sm btn-danger">
                  <i class="fa fa-remove"></i>
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions style="justify-content: flex-end;">
  <button (click)="cancel()" class="btn btn-sm btn-danger" style="margin-right: 5px;">Cancel</button>
  <button (click)="submit()" class="btn btn-sm btn-success">Submit</button>
</mat-dialog-actions>
